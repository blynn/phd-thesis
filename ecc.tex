\chapter {Elliptic Curves}
We review some basic facts about elliptic curves.
By the end of this chapter we will have covered enough theory to implement
standard elliptic curve cryptography except for the problem of generating
suitable elliptic curves.
We discuss pairings in the following chapter, and describe algorithms
to find curve equations in the chapter after that.

Let $\Fq$ be a field for some prime $q > 3$.
Unless otherwise specified we shall always
define curves over a field of prime order and of characteristic greater
than three.

An elliptic curve $E$ is an equation of the form
\[ E: Y^2 = X^3 + a X + b \]
where $a, b \in \Fq$.
Let $\Delta = 4 a^3 + 27b^2$ (the discriminant of the cubic in $x$). Then
$E$ is \emph{singular} if $\Delta = 0$ (so the cubic has distinct solutions),
and \emph{nonsingular} otherwise.

Unless otherwise stated we always consider nonsingular elliptic curves.
(Later we will examine \emph{supersingular} curves which are a
particular kind of nonsingular curves and are \emph{not} singular.
The antonym of supersingular is \emph{ordinary} or \emph{nonsupersingular}.)

For every curve, there is a special point $O$, sometimes denoted $\infty$,
called the \emph{point at infinity}
that is always a solution. (By considering the equation in
projective coordinates one can show that $O = (0,1,0)$ is always a unique
infinite solution to the equation. Intuitively,
the point $O$ can be thought of as the point where all lines
parallel to the Y-axis meet.) The other solutions to the equation $E$
are called \emph{finite points}.

For any field $\Fqk$ define $E(\Fqk)$ (or $E/\Fqk$)
to be the set of all solutions
of $E$ over $\Fqk$ along with the point $O$. We write $\#E(\Fqk)$ 
or $|E(\Fqk)|$ for
the number of elements of $E(\Fqk)$.

We quote two well-known theorems from the theory of elliptic curves.

\begin{theorem}
[Hasse] Let $t = q^k + 1 - \#E(\Fqk)$.
Then $|t| \le 2\sqrt{q^k}$.
\end{theorem}

Thus the number of points on an elliptic curve in a given field
is on the same order as the size of the field.
The quantity $t$ is called the \emph{trace of Frobenius}.

\begin{theorem}
[Weil] Let $t = q + 1 - \#E(\Fq)$
where $q$ is a prime power.
Factor the polynomial $x^2 - t x + q$ as $(x-\alpha)(x-\beta)$ over
$\mathbb{C}[x]$.
Then
\[ \#E(\Fqk) = q^k + 1 - (\alpha^k + \beta^k) .\]
\end{theorem}

This last theorem is more practical in the following form. Let $t_0 = 2$,
Let $t_1 = q + 1 - \#E(\Fq)$.
Define $t_n$ recursively by
\[ t_n = t_1 t_{n-1} - q t_{n-2} .\]
Then $\#E(\Fqk) = q^k + 1 - t_k$.

For example, consider the curve E\cite{bk} given by
\[ Y^2 = X^3 + X + 6 \]
over $\F_{19}$. There are 18 points
\[
\begin{array}{llllll}
(0,5), & (4,6), & (2,4), & (3,6), & (14,3), & (12,13), \\
(18,2), & (10,3), & (6,0), & (10,16), & (18, 17), & (12,6), \\
(14,16), & (3,13), & (2,15), & (4,13), & (0,14), & O
\end{array}
\]
thus the trace of Frobenius $t = 2$.

Over $\F_{{19}^2}$, we have
\[
\#E(\F_{{19}^2}) = 19^2 + 1 - t_2
\]
where $t_2 = 2\cdot 2 - 19 \cdot 2 = -34$, thus
$\#E(\F_{{19}^2}) = 396$.

\section {Twisting Curves}

Let $E$ be an elliptic curve $Y^2 = X^3 + a X + b$ in $\Fq$ where
$q$ is a prime power.
Let $v$ be a quadratic nonresidue in $\Fq$. Consider the
\emph{twist} of $E$: the curve $E'$ defined by $Y^2 = X^3 + a v^2 X + v^3 b$.

Let $g(X) = X^3 + a X + b$, and $h(X) = X^3 + a v^2 X + v^3 b$.
Note $h(X) = v^3 g(Xv^{-1})$.

We consider three cases.

\begin{enumerate}
\item
If $g(xv^{-1}) = 0$ then $v^3g(xv^{-1}) = h(x) = 0$ thus
$Y = 0$ is the unique solution to both the
equations $Y^2 = g(xv^{-1})$ and $Y^2 = h(x)$.
\item
If $g(xv^{-1})$ is a quadratic residue then $Y^2 = g(xv^{-1})$
has exactly two solutions,
and $Y^2 = v^3 g(xv^{-1}) = h(x)$ has no solutions (since $v^3$
is a quadratic nonresidue).
\item
If $g(xv^{-1})$ is a quadratic nonresidue then the situation is reversed:
$Y^2 = g(xv^{-1})$ has no solutions and
and $Y^2 = h(x)$ has exactly two solutions.
\end{enumerate}

Thus as $x$ runs through all the elements of $\Fq$, so does $xv^{-1}$,
and we see that total number of solutions to either equation $E$ and $E'$
over $\Fq$ is $2q$.
Since $O$ is always a solution of any elliptic curve we have
$\#E(\Fq) + \#E(\Fq) = 2q + 2$.

Let $t = q + 1 - \#E(\Fq)$. Then $\#E'(\Fq) = q + 1 + t$.

On the other hand if $v$ is a quadratic residue then $v = c^2$ for some
$c \in \Fq$. Then we have a map $\Psi : E'(\Fq) \rightarrow E(\Fq)$
given by

\[ \Psi(x,y) = (c^2 x,c^3 y) \]

hence in some sense $E$ and $E'$ are the same curve. (For a quadratic
nonresidue $v$, $c$ exists in $\F_{q^2}$ and we have a map between
$E'(\F_{q^2})$ and $E(\F_{q^2})$.)

In practice, we use this fact to change the equation of a given elliptic
curve $E$ into a form that allows certain optimizations.
It turns out that ideally we would like $a = 0$ to reduce the amount of
operations needed to compute on an elliptic curve, but for a general curve
this can never the case. We shall see it is good to have $a = -3$.

Then from above, a curve $Y^2 = X^3 + aX + b$ can be transformed into
one of the form $Y^2 = X^3 - 3X + b$ if we can find $c\in \Fq$
satisfying $a c^4 = -3$.

This is not always possible, so a compromise is to have
$a = 1$ or $a = -3 d^2$ for some small integer $d$
(or $d$ of low Hamming weight), which can be achieved in a similar manner.

\section {The Chord-Tangent Law of Composition}

TODO: pictures

We define an operation $+$ on $E(\Fqk)$.
Let $P = (a,b), Q = (c,d) \in E(\Fqk)$ be finite points.

If $P \ne Q$, then it is not hard to show that if $a \ne c$
then the line through $P$ and $Q$ must intersect $E$ at another point
$(x,y)$ where $x, y\in \Fqk$. Note that $(x,-y)$ also is a solution of $E$.
Define $P + Q = (x, -y)$ for $a \ne c$.
If $a = c$ (in which case we must have $b = -d$),
then define $P + Q = O$.

Now suppose $Q = P$. In this case, consider the tangent line going through
$P$. It turns out it must intersect $E$ at another point $(x,y)$ where
$x,y\in\Fqk$ unless $b = 0$. Define $P + P = (x, -y)$ for $b \ne 0$.
For $b = 0$ define $P + P = O$.

Lastly define $P + O = P$, $O + O = O$.

This operation turns $E(\Fqk)$ into a group.
The point $O$ is the identity, and the inverse
of a point $P = (x,y)$ is the point $-P = (x,-y)$.

As usual, for an integer $n$ define $0 P = O$, $1 P = P$,
$n P = (n-1)P + P$ for $n > 1$ and $n P = -(-n)P$ for $n < 0$.

The previous chapter used mulitplicative group notation to emphasize
the connection
between discrete log cryptosystems and pairing-based cryptosystems.
Traditionally one uses additive group notation for the elliptic curve group
(since the group is Abelian), and we will adhere to this convention in this
section.
Cryptographers sometimes employ multiplicative notation instead,
in order to stress the similarities between the elliptic curve group and
the multiplicative group of a finite field.

For the curve $Y^2 = X^3 + X + 6$ over $\F_{19}$,
it can be verified for instance that
$(0, 5) + (0, 5) = (4, 6)$,
and $(0, 5) + (2, 15) = (4, 13)$.

\section {Singular Elliptic Curves}

We do not discuss cryptography using
singular elliptic curves, because it turns out this
is equvialent to conventional cryptography.
It can be shown that the set $E_{ns}$ nonsingular points (which is all but
one) of a singular ellitpic curve over a field $K$
also form a group under the chord-tangent law,
and either $E_{ns} \cong K^*$ or $E_{ns} \cong K^+$ \cite{prop2.5silverman},
and furthermore these isomorphisms are efficiently computable in either
direction.
(The latter case is not useful as discrete log is easy in $K^+$.)

For example, consider the curve
\[ E : y^2 = x^3 + x^2 \]
This has a singular point at $(0,0)$. Then the other solutions to
this curve (including the point at infinity) form a group
$E_{ns}(\Fqk)$ for any finite field $\Fqk$.

Furthermore, there is an isomorphism $E_{ns}(\Fqk) \rightarrow \Fqk^*$
given by
\[ (x,y) \mapsto \frac{y-x}{y+x} \]
(and maps $O$ to $1$)
which is efficienty computable in either direction.
A little algebra
shows the reverse map is
\[ z \mapsto \left( x', \frac{1+z}{1-z} x' \right) \]
where $x' = 4z/(1-z)^2$ for $z \ne 1$, and $1 \mapsto O$.

Thus cryptography in finite fields can be viewed as a special
case of elliptic curve cryptography, and strictly speaking,
those that complain that elliptic curve cryptography in general
is too experimental and untested must qualify
their remarks by making exceptions for singular curves!

We note that if an efficiently bilinear nondegenerate pairing could be found
for singular curves then the Decisional Diffie-Hellman problem could be broken
in finite fields.

\section {Torsion Points}

Suppose $P\in E(\Fq)$ has order $r$ (so $r P = O$),
where $r$ is coprime to $q$.

Then we must have $r \mid \#E(\Fq)$.
If $r^2 \nmid \#E(\Fq)$ then any random point $P' \in E(\Fq)$
of order $P$ must lie in the group $G = \langle P \rangle$.
Thus discrete log cryptosystems can easily be ported from finite fields
to a group $\langle P \rangle$: instead of using a subgroup of order
$r$ in $K^*$ for some finite field $K$,
we find a subgroup of points of order $r$ in some elliptic curve.

Originally, this was the only goal of elliptic curve cryptography:
researchers focused on finding curves with groups with
suitable orders that were resistant to discrete log attacks and also
efficient to compute on so that conventional cryptography could be
performed in elliptic curves.
In contrast, pairing-based cryptography exploits more facts
about points of a particular order $r$.

It can be proved that for some integer $k \ge 1$,
$E(\Fqk)$ contains $r^2$ points $P$ satisfying $r P = O$,
and there are no other points with this property even if larger field
extensions are considered.

Denote the set of these points by $E[r]$, sometimes called the
\emph{$r$-torsion points} of $E$. It can be shown that

\[ E[r] \cong \mathbb{Z}_r \times \mathbb{Z}_r \]

(that $E[r]$ is the product of two cyclic groups of order $r$).

When $r=2$ this is easy to see: a point has order 2 if and only if it has
a zero $y$-coordinate. As $E$ is nonsingular
$x^3 + ax + b = 0$ has three distinct solutions, thus we can always find
some field $\Fqk$ where $E$ has
four points of order 2: the point $O$ and three points of the form
$(\alpha, 0)$ where $\alpha$ is a root of the cubic.

Moreover,
the line through any two of the finite points is simply the line $Y = 0$,
which certainly intersects $E$ at the other finite point.
The proof is much less trivial for general $r$.

We shall later construct a function
that takes pairs of elements from $E[r]$ and outputs an $r$th root of unity
that is bilinear and nondegnerate.

\section {Explicit Formulas}

Let $E: y^2 = x^3 + ax + b$ be an elliptic curve over $\Fq$. Let
$P_1, P_2 \in E(\Fq)$ and suppose
we wish to find $P_3 = P_1 + P_2$.
Note the case where at least one of $P_1, P_2$ is $O$ is trivial,
so assume both $P_1$ and $P_2$ are finite.
Then write $P_1 = (x_1, y_1), P_2 = (x_2, y_2)$.

If $x_1 = x_2$ and $y_1 = -y_2$
then the line $V$ through $P_1$ and $P_2$ is vertical and
can be given by
\[ V : X - x_1 = 0  . \]
In this case $P_3 = O$ (and $P_1 = -P_2$).

Otherwise $P_3$ also must be finite, hence write $P_3 = (x_3, y_3)$.
We have two cases. If $P_1 = P_2$ then the tangent line $T$ at
$P_1$
has slope
\[\lambda =
\left[ \frac{\partial E / \partial X}{\partial E/ \partial Y} \right]_{(x_1,y_1)}
= \frac{3x_1^2 + a}{2y_1} . \]
and if $P_1 \ne P_2$ then the line $L$ through $P_1$ and $P_2$ has slope
\[ \lambda = (y_2 - y_1)/(x_2 - x_1) . \]

If we set $\mu = y_1 - \lambda x_1$ then
the equation of $L$ or $T$ is given by:

\[ L, T :  Y - (\lambda X + \mu) = 0 \]

We can find the $x$-coordinate of the other point of intersection $(x_3, -y_3)$
by substituting $Y = \lambda X + \mu$ into $E$. We find
\[ E(X, \lambda X+\mu) = X^3 - \lambda^2 X^2 + a_1 X + a_0 = 0 \]
for some $a_1, a_0 \in \Fq$, thus the sum of the roots
$x_1 + x_2 + x_3 = \lambda^2$.

This allows us to compute $x_3, y_3$. Explicitly we have for $P_1 \ne P_2$:

\[
\begin{array}{rcl}
\lambda &\leftarrow& (y_2 - y_1)/(x_2 - x_1) \\
x_3 &\leftarrow& \lambda^2 - x_1 - x_2 \\
y_3 &\leftarrow& (x_1 - x_3) \lambda - y_1
\end{array}
\]
and for $P_1 = P_2$:
\[
\begin{array}{rcl}
\lambda &\leftarrow& (3x_1^2 + a)/(2y_1) \\
x_3 &\leftarrow& \lambda^2 - 2x_1 \\
y_3 &\leftarrow& (x_1 - x_3) \lambda - y_1
\end{array}
\]
In practice the most expensive step is the division in the computation of
$\lambda$.

The expressions for the lines $L,T,V$ will be used later in the computation
of a pairing.

\section {Representing Points}

Instead of using a pair of numbers to represent a point,
we can use Jacobian projective coordinates: the triplet
$(x,y,z)$ represents the point $(x/z^2, y/z^3)$.

Then to double the point $(x,y,z)$, we compute $(x_3, y_3, z_3)$ by:

\[
\begin{array}{rcl}
\lambda_1 & \leftarrow & 3x^2 + a z^4 \\
z_3 & \leftarrow & 2yz \\
\lambda_2 & \leftarrow & 4xy^2 \\
x_3 & \leftarrow & \lambda_2^2 - 2 \lambda_2 \\
\lambda_3 & \leftarrow & 8 y^4 \\
y_3 & \leftarrow & \lambda_1(\lambda_2 - x_3) - \lambda_3
\end{array}
\]

We see the computation of $3x^2 + a z^4$ in general costs $3S + 1M$
where $M$ and $S$ denote the time required for a multiplication and
a squaring respectively. (We consider multiplication by
a small constant to be negligible.)

For $a=0$ tthe cost is only $1S$.

For small $a$ or fairly small $a$ with low Hamming weight the cost is $3S$.

For $a=-3$ we may compute $\lambda_1 = 3(x+z^2)(x-z^2)$ which costs
$1M + 1S$.

For $a = -3 d^2$ where $d$ is small or fairly small with low Hamming weight,
we may compute $\lambda_1 = 3(x+dz^2)(x-dz^2)$ which also costs $1M + 1S$.
By transforming the curve using the procedure mentioned in the first section,
we can always obtain an $a$ that is faster than the general case.

We omit the formulas for projective point addition, and for adding
an affine point to a projective point, referring the reader instead
to Blake et al. or Cohen et al. \cite{stuff}.
The latter investigate other kinds of projective coordinates, where point
doubling or multiplication is even faster.

We can optimize point representations for space instead of time.
Given $x$, we can solve $Y^2 = x^3 + ax + b$ for $Y$, thus
a point $(x,y)$ can be represented by $x$ along with a single bit indicating
which solution of $y$ to take. We discuss how to find square roots later.

Alternatively, for some cases we can simply use $x$ alone. For example,
suppose Alice needs to send Bob a point in some cryptosystem. She sends
Bob $x$, who guesses the solution $y$. Bob attempts to proceed normally.
If the protocol fails (e.g. the signature does not verify) then Bob tries
$-y$ and tries again. This does not cost much more since the solutions are
related by negation, and we will see that in some pairing-based systems
one can check both possibilities at the same time.

(Of course we can take this principle further. If every bit matters, Alice can
omit $k$ bits of $x$, and leave Bob to try all $2^k$ possibilities.)

\section {Point Multiplication}

Preprocessing. Sliding Windows. Multiexp.

Not so useful for us, but maybe in $G_2$? look into this!

Ciet Lange Sica Quisquater

Cohen Miyaji Ono

\section {Finding Random Points}

Cantor-Zassenhaus.
Bernstein.
